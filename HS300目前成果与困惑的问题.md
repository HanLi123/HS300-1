# 沪深300指数纯因子组合构建

> WIFA量化组，2019年春。

依据多因子模型，尝试对沪深300指数构建纯因子组合。

详细说明文档及代码：https://github.com/WIFAQuant/HS300

# 目前的成果

## 已完成：

### 因子数据处理

填补缺失值：**向前填充**法填补缺失值

去极值：采用**参数值为60的MAD法**进行去极值处理

标准化：原始因子值进行标准化(z-score)

中性化：线性回归，通过前三步处理后对市值因子和行业因子的回归残差项作为新的因子暴露

### 大类因子合成

计算月度IC值，然后计算过去24个月的IC_IR作为权重

IC_I采用以下两种方式

静态：直接使用最新的24个月的IC_IR对所有不同时间截面的数据进行加权

动态：在每个时间截面上计算过去24个月的IC_IR,不同时间使用的权重不同

结果显示动态的加权方式大类因子的分布更加具有尖峰的性质，在因子回归模型中，两种加权方式的结果很相近
### 收益预测模型

$r_j^t = \sum_{s=1}^S X_{js}^t*f_s^t+ \sum_{k=1}^K X_{jk}^t*f_k^t+X_{jm}^t*f_m^t+u_j^t$

j为股票，s为行业，k为7个大类因子，m为一个market因子

使用WLS回归，得到每期的因子收益值，每期$R^2$表现如下

![R_square](D:\coco\WORK\WIFA\HS300\H3 Plots\R_square.png)

估计因子预期收益时采用N=12的历史均值法。

即采取最新已知的12个月的因子历史收益率均值作为T+1期因子的预期收益率。

T+1期=2019.2.28 预测结果和真实值比较如下

![yhat_y](D:\coco\WORK\WIFA\HS300\H3 Plots\yhat_y.png)

发现预测效果非常不好，我们发现在使用历史因子收益平均值作为预测值时，正负值进行平均后估计值接近0，如图为最近一月的因子收益与最近12月因子收益平均值对比图：

![factor_income_decrease](D:\coco\WORK\WIFA\HS300\H3 Plots\factor_income_decrease.png)

### 组合优化：

优化目标：组合预期收益率最大化

约束条件：对目标纯因子不做约束，对非目标纯因子要求偏离不超过0.03，风险因子市值和行业因子偏离不超过0.03

严格根据以上搭建了组合，可以从7个大类因子中任选几个因子作为目标纯因子，剩下的风格因子为非目标纯因子，然后构建组合。由于股票预测的收益率效果不好，组合优化还没有得出有意义的结果。


## 困惑
### 1.收益预测模型中对T+1期因子收益的预期方式
我们发现仅仅用历史均值法表现并不好，所以尝试用ARIMA模型预测
测试大类因子之一VALUE时发现ARIMA(p,d,q)模型也不太适用
如图为VALUE和PROFIT因子的判断p,q的ACF、PACF图。（这两个因子经过ADF test，本身是平稳的）

![value_profit](D:\coco\WORK\WIFA\HS300\H3 Plots\ARIMA\value_profit.png)

发现p,q值不好判断，我们猜测模型ARIMA对其不适用。

此处的**困惑**：我们的建模过程中是否有错误？其他有什么更好/常用的方法可以预测因子收益？

### 2.组合的预期风险的计算，包括因子风险和特质风险的预测，尤其是特质风险，步骤比较复杂，对内容不是很理解，不知导师们有没有相关的材料可以参考一下？

我们的组合现在是最大化收益，然后约束非目标纯因子和风险因子的暴露，但是没有对组合的风险进行限制。

计算组合的预期风险需要用到因子风险的预测和特质（残差）风险的预测，其中内容比较复杂，尤其是特质风险的预测需要经过很多步的处理，目前有阅读barra中写到的先使用半衰期权重对历史特质风险加权，然后进行贝叶斯收缩，最后进行波动机制调整，现在还不是很理解每一步的方法和原理，不知道导师们有没有这方面的资料可以参考一下。
